services:
  ingress-rpc:
    build:
      context: .
      dockerfile: crates/ingress-rpc/Dockerfile
    container_name: tips-ingress-rpc
    ports:
      - "8080:8080"
    env_file:
      - .env.docker
    restart: unless-stopped

  audit:
    build:
      context: .
      dockerfile: crates/audit/Dockerfile
    container_name: tips-audit
    env_file:
      - .env.docker
    restart: unless-stopped

  maintenance:
    build:
      context: .
      dockerfile: crates/maintenance/Dockerfile
    container_name: tips-maintenance
    env_file:
      - .env.docker
    restart: unless-stopped

  ui:
    build:
      context: .
      dockerfile: ui/Dockerfile
    ports:
      - "3000:3000"
    container_name: tips-ui
    env_file:
      - .env.docker
    restart: unless-stopped

  ingress-writer:
    build:
      context: .
      dockerfile: crates/ingress-writer/Dockerfile
    container_name: tips-ingress-writer
    env_file:
      - .env.docker
    restart: unless-stopped

  simulator:
    build:
      context: .
      dockerfile: crates/simulator/Dockerfile
    container_name: tips-simulator
    ports:
      # Listen on the loopback interface to fail fast if the ports are already in use by op-rbuilder
      - "127.0.0.1:2222:2222"
      - "127.0.0.1:4444:4444"
    volumes:
      - ${TIPS_SIMULATOR_DATADIR}:/data
      - ${TIPS_SIMULATOR_BUILDER_PLAYGROUND_DIR}:/playground
    env_file:
      - .env.docker
    restart: unless-stopped
    profiles:
      - simulator
